{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}{{ city }} Real Estate Analysis{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4" style="color: var(--netflix-red);">{{ city }} Housing Analysis</h1>

    <!-- Area Selection -->
    <div class="analysis-filter-card">
        <div class="card-body">
            <form method="get">
                <select name="area" class="analysis-select" onchange="this.form.submit()">
                    {% for area in areas %}
                        <option value="{{ area }}" {% if area == selected_area %}selected{% endif %}>
                            {{ area|title }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>

    <div class="scroll-arrow left-arrow">‚ùÆ</div>
    <div class="scroll-arrow right-arrow">‚ùØ</div>

    <div class="analysis-row">
        <!-- Price per Sqft -->
        <div class="analysis-card">
            <div class="card-header">üèòÔ∏è Price per Sqft</div>
            <div class="card-body">
                <img src="data:image/png;base64,{{ graphics.price_per_sqft }}" alt="Price per square foot">
                <div class="graph-description">
                    {{ descriptions.price_per_sqft }}
                </div>
            </div>
        </div>

        <!-- Property Type Distribution -->
        <div class="analysis-card">
            <div class="card-header">üè° Property Types</div>
            <div class="card-body">
                <img src="data:image/png;base64,{{ graphics.property_type }}" alt="Property types">
                <div class="graph-description">
                    {{ descriptions.property_type }}
                </div>
            </div>
        </div>

        <!-- Price vs Size -->
        <div class="analysis-card">
            <div class="card-header">üìà Price vs Size</div>
            <div class="card-body">
                <img src="data:image/png;base64,{{ graphics.price_vs_size }}" alt="Price vs size">
                <div class="graph-description">
                    {{ descriptions.price_vs_size }}
                </div>
            </div>
        </div>

        <!-- Bedroom Analysis -->
        <div class="analysis-card">
            <div class="card-header">üõèÔ∏è Bedroom Prices</div>
            <div class="card-body">
                <img src="data:image/png;base64,{{ graphics.bedroom_prices }}" alt="Bedroom prices">
                <div class="graph-description">
                    {{ descriptions.bedroom_prices }}
                </div>
            </div>
        </div>

        <!-- Correlation Heatmap -->
        <div class="analysis-card">
            <div class="card-header">üîó Correlations</div>
            <div class="card-body">
                <img src="data:image/png;base64,{{ graphics.correlation }}" alt="Correlations">
                <div class="graph-description">
                    {{ descriptions.correlation }}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fullscreen Overlay -->
<div class="fullscreen-overlay">
    <span class="close-btn">&times;</span>
    <img class="fullscreen-image" src="" alt="Fullscreen view">
</div>

<script>
    // Horizontal scroll functionality
    const row = document.querySelector('.analysis-row');
    const cardWidth = 280 + 25;

    document.querySelector('.right-arrow').addEventListener('click', () => {
        row.scrollBy({ left: cardWidth, behavior: 'smooth' });
    });

    document.querySelector('.left-arrow').addEventListener('click', () => {
        row.scrollBy({ left: -cardWidth, behavior: 'smooth' });
    });

    // Fullscreen functionality
    document.querySelectorAll('.analysis-card img').forEach(img => {
        img.addEventListener('click', () => {
            const overlay = document.querySelector('.fullscreen-overlay');
            const fullscreenImg = overlay.querySelector('.fullscreen-image');
            fullscreenImg.src = img.src;
            overlay.style.display = 'flex';
        });
    });

    // Close overlay
    document.querySelector('.close-btn').addEventListener('click', () => {
        document.querySelector('.fullscreen-overlay').style.display = 'none';
    });

    document.querySelector('.fullscreen-overlay').addEventListener('click', (e) => {
        if (e.target === document.querySelector('.fullscreen-overlay')) {
            document.querySelector('.fullscreen-overlay').style.display = 'none';
        }
    });
</script>
{% endblock %}